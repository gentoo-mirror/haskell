# Copyright 1999-2025 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=8

# ebuild generated by hackport 0.9.0.0.9999

CABAL_FEATURES="lib profile haddock hoogle hscolour"
inherit haskell-cabal

DESCRIPTION="Test utilities for Haddock"
HOMEPAGE="https://www.haskell.org/haddock/"

GIT_REPO="https://gitlab.haskell.org/ghc/haddock"
# pinned commit for haddock submodule in ghc-9.8
GIT_COMMIT="bb7b9480b0825d3fa978e61c7faf25dce718a305"
GIT_P="haddock-${GIT_COMMIT}"

SRC_URI="${GIT_REPO}/-/archive/${GIT_COMMIT}.tar.gz
	-> ${GIT_P}.tar.gz"

S="${WORKDIR}/${GIT_P}/${CABAL_PN}"
CABAL_FILE="${S}/${CABAL_PN}.cabal"

LICENSE="BSD-2"
SLOT="0/${PV}"
KEYWORDS="~amd64"

RDEPEND="
	dev-haskell/cabal:=[profile?]
	>=dev-lang/ghc-9.0.2:=
"
DEPEND="${RDEPEND}
	>=dev-haskell/cabal-3.4.1.0
"

src_prepare() {
	sed -i -e \
		's/^\(version:.*\)0\.0\.0\.1/\1'"${PV}"'/' \
		"${CABAL_FILE}" || die
	haskell-cabal_src_prepare
}
